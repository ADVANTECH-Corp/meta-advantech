From f7417a41929ad2059b4d188ac385e2c4e072f401 Mon Sep 17 00:00:00 2001
From: Your Name <you@example.com>
Date: Wed, 13 Jan 2016 17:26:03 +0800
Subject: [PATCH] porting pcie function


diff --git a/drivers/pci/host/pci-imx6.c b/drivers/pci/host/pci-imx6.c
old mode 100644
new mode 100755
index 405c184..e5db7fd
--- a/drivers/pci/host/pci-imx6.c
+++ b/drivers/pci/host/pci-imx6.c
@@ -33,6 +33,15 @@
 
 #include "pcie-designware.h"
 
+#ifdef CONFIG_ARCH_ADVANTECH
+bool pcie_testmode = true;
+u32 pcie_gen1_value = 0 << 0;
+u32 pcie_gen2_3p5db_vlaue = 0 << 6;
+u32 pcie_gen2_6db_value = 20 << 12;
+u32 pcie_swing_full_vlaue = 127 << 18;
+u32 pcie_swing_low_vlaue = 127 << 25;
+#endif
+
 #define to_imx6_pcie(x)	container_of(x, struct imx6_pcie, pp)
 
 /*
@@ -518,6 +527,18 @@ static int imx6_pcie_init_phy(struct pcie_port *pp)
 		regmap_update_bits(imx6_pcie->iomuxc_gpr, IOMUXC_GPR12,
 				IMX6Q_GPR12_LOS_LEVEL, IMX6Q_GPR12_LOS_LEVEL_9);
 
+#ifdef CONFIG_ARCH_ADVANTECH
+	regmap_update_bits(imx6_pcie->iomuxc_gpr, IOMUXC_GPR8,
+			IMX6Q_GPR8_TX_DEEMPH_GEN1, pcie_gen1_value);
+	regmap_update_bits(imx6_pcie->iomuxc_gpr, IOMUXC_GPR8,
+			IMX6Q_GPR8_TX_DEEMPH_GEN2_3P5DB, pcie_gen2_3p5db_vlaue);
+	regmap_update_bits(imx6_pcie->iomuxc_gpr, IOMUXC_GPR8,
+			IMX6Q_GPR8_TX_DEEMPH_GEN2_6DB, pcie_gen2_6db_value);
+	regmap_update_bits(imx6_pcie->iomuxc_gpr, IOMUXC_GPR8,
+			IMX6Q_GPR8_TX_SWING_FULL, pcie_swing_full_vlaue);
+	regmap_update_bits(imx6_pcie->iomuxc_gpr, IOMUXC_GPR8,
+			IMX6Q_GPR8_TX_SWING_LOW, pcie_swing_low_vlaue);
+#else
 		regmap_update_bits(imx6_pcie->iomuxc_gpr, IOMUXC_GPR8,
 				IMX6Q_GPR8_TX_DEEMPH_GEN1, 20 << 0);
 		regmap_update_bits(imx6_pcie->iomuxc_gpr, IOMUXC_GPR8,
@@ -528,6 +549,7 @@ static int imx6_pcie_init_phy(struct pcie_port *pp)
 				IMX6Q_GPR8_TX_SWING_FULL, 115 << 18);
 		regmap_update_bits(imx6_pcie->iomuxc_gpr, IOMUXC_GPR8,
 				IMX6Q_GPR8_TX_SWING_LOW, 115 << 25);
+#endif
 	}
 
 	return 0;
-- 
1.7.9.5

